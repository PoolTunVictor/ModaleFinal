<div class="users-page">

  <!-- ================= HEADER ================= -->
  <div class="header">
    <div>
      <h1 class="title">GESTIÃ“N DE USUARIOS</h1>
      <p class="subtitle">
        Administra el acceso y los permisos de los usuarios registrados.
      </p>
    </div>
  </div>

  <!-- ================= FILTROS ================= -->
  <div class="filters-card">

    <div class="search-box">
      <span class="material-symbols-outlined">search</span>
      <input
        type="text"
        placeholder="Buscar por correo electrÃ³nico..."
        [(ngModel)]="searchEmail"
        (input)="applyFilters()"
      >
    </div>

    <div class="filters">
      <select [(ngModel)]="roleFilter" (change)="applyFilters()">
        <option value="all">Todos los roles</option>
        <option value="admin">Administrador</option>
        <option value="cliente">Cliente</option>
      </select>
    </div>

  </div>

  <!-- ================= TABLA ================= -->
  <div class="table-card">

    <table class="users-table">
      <thead>
        <tr>
          <th>Usuario</th>
          <th>Rol</th>
          <th>Estado</th>
        </tr>
      </thead>

      <!-- â³ LOADING -->
      <tbody *ngIf="isLoading">
        <tr>
          <td colspan="5" class="loading-cell">
            Cargando usuarios...
          </td>
        </tr>
      </tbody>

      <!-- âœ… USUARIOS -->
      <tbody *ngIf="!isLoading">

        <tr *ngFor="let user of filteredUsers">

          <!-- Usuario -->
          <td class="user-cell">
            <img src="/assets/user-placeholder.png" alt="avatar">
            <div>
              <strong>{{ user.email.split('@')[0] }}</strong>
              <small>{{ user.email }}</small>
            </div>
          </td>

          <!-- Rol -->
          <td>
            <select
              class="role-select"
              [value]="user.role"
              (change)="changeRole(user, $event)"
            >
              <option value="admin">Administrador</option>
              <option value="cliente">Cliente</option>
            </select>
          </td>

          <!-- Estado -->
          <td>
            <span class="status active">Activo</span>
          </td>

          <!-- Ãšltimo acceso -->
          <td>â€”</td>

          <!-- Acciones -->
          <td class="actions">
            <button
              class="icon-btn danger"
              (click)="deleteUser(user)"
              title="Eliminar usuario"
            >
              ðŸ—‘
            </button>
          </td>

        </tr>

        <!-- SIN USUARIOS -->
        <tr *ngIf="filteredUsers.length === 0">
          <td colspan="5" class="loading-cell">
            No hay usuarios que coincidan con el filtro
          </td>
        </tr>

      </tbody>
    </table>

    <!-- ================= FOOTER TABLA ================= -->
    <div class="table-footer">
      <span>
        Mostrando {{ filteredUsers.length }} usuario(s)
      </span>

    </div>

  </div>

</div>

<!-- ================= MODAL CONFIRMACIÃ“N ================= -->

<div class="modal-backdrop" *ngIf="showConfirmModal" (click)="closeConfirmModal()"></div>

<div class="confirm-modal" *ngIf="showConfirmModal">
  <h3>{{ confirmTitle }}</h3>

  <p>{{ confirmMessage }}</p>

  <div class="modal-actions">
    <button class="btn-outline" (click)="closeConfirmModal()">
      Cancelar
    </button>

    <button class="btn-primary danger" (click)="confirm()">
      Confirmar
    </button>
  </div>
</div>
