<h1 class="title">GESTIÃ“N DE PEDIDOS</h1>
<p class="subtitle">Administra todos los pedidos</p>

<div class="card">

  <!-- Loading -->
  <p *ngIf="isLoading">Cargando pedidos...</p>

  <!-- Tabla -->
  <table *ngIf="!isLoading && orders.length > 0">
    <thead>
      <tr>
        <th>ID</th>
        <th>Usuario</th>
        <th>Fecha</th>
        <th>Total</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let order of orders">

        <td>#{{ order.id }}</td>

        <td>
          <strong>{{ order.user?.email.split('@')[0] }}</strong><br>
          <small>{{ order.user?.email }}</small>
        </td>

        <td>{{ order.created_at | date:'dd/MM/yyyy' }}</td>

        <td>${{ order.total }}</td>

        <td>
          <select
            #statusSelect
            class="status-select"
            [value]="order.status"
            (change)="changeStatus(order.id, statusSelect.value)"
          >
            <option value="pendiente">Pendiente</option>
            <option value="en camino">En camino</option>
            <option value="entregado">Entregado</option>
          </select>
        </td>

        <td class="actions">
          <button
            class="print"
            title="Imprimir ficha"
            (click)="openPrintModal(order)"
          >
            ğŸ–¨ï¸
          </button>

          <button
            class="delete"
            title="Eliminar pedido"
            (click)="deleteOrder(order.id)"
          >
            ğŸ—‘ï¸
          </button>
        </td>

      </tr>
    </tbody>
  </table>

  <p *ngIf="!isLoading && orders.length === 0">
    No hay pedidos registrados.
  </p>

</div>

<!-- ===================== -->
<!-- MODAL FICHA -->
<!-- ===================== -->

<div
  class="modal-backdrop"
  *ngIf="showPrintModal"
  (click)="closePrintModal()"
></div>

<div
  class="modal print-modal"
  *ngIf="showPrintModal && selectedOrder"
  (click)="$event.stopPropagation()"
>

  <!-- HEADER -->
  <h2 class="modal-title">ğŸ“¦ Ficha de Entrega</h2>

  <!-- CONTENIDO CON SCROLL -->
  <div class="modal-content">

    <div id="printArea" class="print-sheet">

      <!-- CLIENTE -->
      <section>
        <h3>ğŸ‘¤ Cliente</h3>
        <p><strong>Email:</strong> {{ selectedOrder.user.email }}</p>
        <p><strong>TelÃ©fono:</strong> {{ selectedOrder.address.phone }}</p>
      </section>

      <hr />

      <!-- DIRECCIÃ“N -->
      <section>
        <h3>ğŸ“ DirecciÃ³n</h3>
        <p>
          {{ selectedOrder.address.street }},
          {{ selectedOrder.address.city }},
          {{ selectedOrder.address.state }},
          {{ selectedOrder.address.postal_code }}
        </p>

        <p *ngIf="selectedOrder.address.references">
          <strong>Referencias:</strong>
          {{ selectedOrder.address.references }}
        </p>
      </section>

      <hr />

      <!-- PEDIDO -->
      <section>
        <h3>ğŸ§¾ Pedido</h3>
        <p><strong>ID:</strong> #{{ selectedOrder.id }}</p>
        <p>
          <strong>Fecha:</strong>
          {{ selectedOrder.created_at | date:'dd/MM/yyyy' }}
        </p>

        <table class="print-table">
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cant.</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let item of selectedOrder.items">
              <td>{{ item.product_name }}</td>
              <td>{{ item.quantity }}</td>
            </tr>
          </tbody>
        </table>

        <p class="total">
          <strong>Total:</strong> ${{ selectedOrder.total }}
        </p>
      </section>

    </div>
  </div>

  <!-- BOTONES FIJOS -->
  <div class="modal-actions">
    <button class="outline" (click)="closePrintModal()">Cerrar</button>
    <button class="primary" (click)="print()">Imprimir ficha</button>
  </div>

</div>